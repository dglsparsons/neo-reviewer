*neo_reviewer.txt*  GitHub PR reviewer for Neovim

==============================================================================
CONTENTS                                                 *neo_reviewer-contents*

    1. Introduction .......................... |neo_reviewer-introduction|
    2. Requirements .......................... |neo_reviewer-requirements|
    3. Installation .......................... |neo_reviewer-installation|
    4. Configuration ......................... |neo_reviewer-configuration|
    5. Commands .............................. |neo_reviewer-commands|
    6. Functions ............................. |neo_reviewer-functions|
    7. Keymaps ............................... |neo_reviewer-keymaps|

==============================================================================
1. INTRODUCTION                                      *neo_reviewer-introduction*

neo-reviewer is a Neovim plugin for reviewing GitHub pull requests directly in
your editor. It provides:

- Single-buffer inline diff view with gutter indicators
- Expandable old code preview (toggle to see what was changed)
- Navigation between changes
- Add review comments directly from Neovim
- View existing PR comments inline with threaded replies and reply counts
- Reply to comment threads
- GitHub suggestion support with diff preview and one-key apply
- Multi-line comments with visual range selection
- Submit reviews (approve or request changes)
- Telescope integration for file picker
- Local git diff review (review uncommitted changes before pushing)
- AI-powered review analysis (optional, via opencode)

==============================================================================
2. REQUIREMENTS                                      *neo_reviewer-requirements*

- Neovim >= 0.9.0
- plenary.nvim (required)
- telescope.nvim (optional, for file picker)
- neo-reviewer CLI (Rust CLI tool)
- GitHub authentication via `gh` CLI

==============================================================================
3. INSTALLATION                                      *neo_reviewer-installation*

Using lazy.nvim: >lua
    {
        "dglsparsons/neo-reviewer",
        dependencies = { "nvim-lua/plenary.nvim" },
        config = function()
            require("neo_reviewer").setup({})
        end,
    }
<

Install the CLI tool: >bash
    cd /path/to/neo-reviewer
    cargo install --path cli
<

Authenticate with GitHub: >bash
    gh auth login
<

==============================================================================
4. CONFIGURATION                                    *neo_reviewer-configuration*

Call setup() with your options: >lua
    require("neo_reviewer").setup({
        cli_path = "neo-reviewer",  -- Path to CLI binary
        signs = {
            add = "+",
            delete = "-",
            change = "~",
        },
        wrap_navigation = true,      -- Wrap ]c/[c at file boundaries
        auto_expand_deletes = false, -- Auto-expand deleted lines
        thread_window = {
            keys = {
                close = { "q", "<Esc>" },  -- Keys to close thread window
                reply = "r",               -- Key to reply to comment
                toggle_old = "o",          -- Toggle old code in suggestion
                apply = "a",               -- Apply suggestion to buffer
            },
        },
        input_window = {
            keys = {
                submit = "<C-s>",   -- Key to submit comment/reply
                cancel = "<Esc>",   -- Key to cancel input
            },
        },
        ai = {
            enabled = false,                      -- Run AI analysis by default
            model = "anthropic/claude-haiku-4-5", -- Model for opencode
            command = "opencode",                 -- Command to invoke
            walkthrough_window = {
                height = 0,                 -- Auto size to content (min height)
                focus_on_open = false,      -- Keep focus on diff window
            },
        },
    })
<

                                                *neo_reviewer-config-thread_window*
thread_window.keys ~
    Configure keybindings for the comment thread floating window.
    - `close`: Key(s) to close the window. String or table of strings.
    - `reply`: Key(s) to reply to the comment under cursor.
    - `toggle_old`: Key(s) to toggle display of current code in suggestions.
    - `apply`: Key(s) to apply a suggestion to the buffer.

                                                 *neo_reviewer-config-input_window*
input_window.keys ~
    Configure keybindings for the comment/reply input floating window.
    This window allows multi-line input for comments, replies, and review
    messages (e.g., when requesting changes).
    - `submit`: Key to submit the input (default: "<C-s>").
    - `cancel`: Key to cancel and close the input window (default: "<Esc>").

                                                           *neo_reviewer-config-ai*
ai ~
    Configure AI-powered review analysis. Requires `opencode` CLI to be
    installed and configured.
    - `enabled`: Run AI analysis by default (default: false).
    - `model`: Model to use for analysis (default: "anthropic/claude-haiku-4-5").
    - `command`: Command to invoke opencode (default: "opencode").
    - `walkthrough_window.height`: Minimum height of the walkthrough split
      (default: 0, auto-sized to content).
    - `walkthrough_window.focus_on_open`: Focus the walkthrough window when it opens (default: false).

    When AI analysis is enabled, neo-reviewer generates a plain-language
    overview and an ordered walkthrough of the PR with step-by-step
    explanations. The walkthrough opens automatically and updates as you
    navigate hunks. Use |neo_reviewer.toggle_ai_feedback()| to open or
    re-open the walkthrough window.

==============================================================================
5. COMMANDS                                              *neo_reviewer-commands*

These user commands are created when you call `setup()`.

:ReviewPR [--analyze|--no-analyze] [arg]                             *:ReviewPR*
    Open a PR for review. Accepts optional arguments:
    - No argument: detects PR for current branch
    - A PR number: checks out the PR branch and opens review
    - A GitHub PR URL: https://github.com/owner/repo/pull/123
    - A branch name: checks out the PR for that branch and opens review
    - `--analyze`: Force AI analysis on (overrides config)
    - `--no-analyze`: Force AI analysis off (overrides config)

    Examples: >
        :ReviewPR                        " Current branch PR
        :ReviewPR 123                    " Checkout PR #123
        :ReviewPR --analyze              " Current branch with AI
        :ReviewPR --analyze https://...  " URL with AI analysis
<

:ReviewDiff [--analyze|--no-analyze]                               *:ReviewDiff*
    Review local git diff (both staged and unstaged changes). Comments are
    written to `REVIEW_COMMENTS.md` in the project root.
    - `--analyze`: Force AI analysis on (overrides config)
    - `--no-analyze`: Force AI analysis off (overrides config)

    Examples: >
        :ReviewDiff              " Local diff, default AI setting
        :ReviewDiff --analyze    " Local diff with AI analysis
<

:AddComment                                                        *:AddComment*
    Add a review comment at cursor position. Supports visual range selection
    for multi-line comments. In visual mode, the selected lines become the
    comment range.

:Approve                                                              *:Approve*
    Submit an approval for the current PR review.

:RequestChanges [message]                                      *:RequestChanges*
    Submit a "request changes" review for the current PR. The message is
    optional; if not provided, opens a multi-line input window.

:ReviewDone                                                        *:ReviewDone*
    End the current review session without submitting a review. If the review
    was opened with a PR number (which checks out the PR branch), this restores
    the previous branch and pops any stashed changes.

:ReviewSync                                                        *:ReviewSync*
    Sync the current PR review with GitHub. Fetches the latest comments
    and diff changes. Preserves cursor position and expanded hunk state.
    Only works during an active PR review (not local diff reviews).

==============================================================================
6. FUNCTIONS                                            *neo_reviewer-functions*

require("neo_reviewer").review_pr({arg})                   *neo_reviewer.review_pr()*
    Open a PR for review. Accepts:
    - No argument: detects PR for current branch
    - A PR number: checks out the PR branch and opens review
    - A GitHub PR URL: https://github.com/owner/repo/pull/123
    - A branch name: checks out the PR for that branch and opens review

require("neo_reviewer").review_diff({opts})               *neo_reviewer.review_diff()*
    Review local git diff (both staged and unstaged changes). This allows
    you to review code changes before committing. Accepts optional {opts}:
    - `analyze`: boolean to force AI analysis on/off (overrides config)

    Comments are written to `REVIEW_COMMENTS.md` in the project root with
    the format:
>
        # Review Comments

        ## file=path/to/file.lua:line=42
        Your comment about the code here.

        ## file=path/to/file.lua:line=100-105
        Multi-line comment spanning lines 100-105.
<
    This file can be fed to an AI agent or used as a review checklist.
    The file is cleared each time you start a new local diff review.

require("neo_reviewer").next_hunk()                         *neo_reviewer.next_hunk()*
    Jump to the next change in the file.

require("neo_reviewer").prev_hunk()                         *neo_reviewer.prev_hunk()*
    Jump to the previous change in the file.

require("neo_reviewer").next_comment()                   *neo_reviewer.next_comment()*
    Jump to the next comment in the review. Works in both PR review mode
    (GitHub comments) and local diff review mode. Navigates across files.
    Respects |wrap_navigation| config option.

require("neo_reviewer").prev_comment()                   *neo_reviewer.prev_comment()*
    Jump to the previous comment in the review. Works in both PR review mode
    (GitHub comments) and local diff review mode. Navigates across files.
    Respects |wrap_navigation| config option.

require("neo_reviewer").toggle_prev_code()           *neo_reviewer.toggle_prev_code()*
    Toggle inline preview of old code at cursor position.

require("neo_reviewer").add_comment({opts})               *neo_reviewer.add_comment()*
    Add a review comment. When called with {line1} and {line2} in opts,
    creates a multi-line comment spanning those lines. Otherwise comments
    on the current cursor line.

    Multi-line comments show brackets on the right (aligned to window edge),
    so diff signs remain visible:
>
        10 | +  code line 1                              [
        11 | ~  code line 2                              |
        12 | +  code line 3  @reviewer: comment          ]
<
    Opening the thread window (|neo_reviewer.show_comment()|) works from any
    line within the comment range.

require("neo_reviewer").show_comment()                   *neo_reviewer.show_comment()*
    Show the comment thread for the current line in a floating window.
    If there are comments on the line, opens an interactive window where
    you can view the full thread and reply to any comment.

    GitHub Suggestions ~
    Comments containing GitHub suggestions (```suggestion blocks) are
    displayed with a diff-style preview:
>
        ┌─ Suggestion ─────────────────────────
        ~ │ local descriptive_name = foo()
        └──────────────────────────────────────
<
    The `~` gutter indicates new code. Press the toggle key (default: `o`)
    to show what current code would be replaced:
>
        ┌─ Suggestion ─────────────────────────
            │ local x = foo()                    (old, red)
        ~ │ local descriptive_name = foo()
        └──────────────────────────────────────
<
    Press the apply key (default: `a`) to replace the buffer content with
    the suggestion. This modifies the buffer locally (not committed).
    Multi-line suggestions are fully supported.

require("neo_reviewer").show_file_picker()           *neo_reviewer.show_file_picker()*
    Show the file picker (Telescope or fallback) to switch between changed
    files in the PR.

require("neo_reviewer").check_auth()                       *neo_reviewer.check_auth()*
    Check GitHub authentication status and notify the result.

require("neo_reviewer").approve()                             *neo_reviewer.approve()*
    Submit an approval for the current PR review.

require("neo_reviewer").request_changes({message})   *neo_reviewer.request_changes()*
    Submit a "request changes" review for the current PR. The {message}
    parameter is optional; if not provided or empty, opens a multi-line
    input window for entering the review message.

require("neo_reviewer").done()                                   *neo_reviewer.done()*
    Close the current review and restore previous state. If the review was
    opened with a PR number (which checks out the PR branch), this restores
    the previous branch and pops any stashed changes.

require("neo_reviewer").sync()                                   *neo_reviewer.sync()*
    Sync the current PR review with GitHub. Re-fetches PR data including
    comments and diff changes. Preserves cursor position, expanded hunk
    state, and checkout state. Only works during an active PR review.
    See |:ReviewSync|.

require("neo_reviewer").toggle_ai_feedback()     *neo_reviewer.toggle_ai_feedback()*
    Toggle the AI walkthrough window open/closed. The walkthrough updates
    as you navigate hunks with next/prev.

==============================================================================
7. KEYMAPS                                                *neo_reviewer-keymaps*

neo-reviewer does not set any keymaps by default. Add your own: >lua
    vim.keymap.set("n", "]c", function()
        require("neo_reviewer").next_hunk()
    end, { desc = "Next change" })

    vim.keymap.set("n", "[c", function()
        require("neo_reviewer").prev_hunk()
    end, { desc = "Previous change" })

    vim.keymap.set("n", "]C", function()
        require("neo_reviewer").next_comment()
    end, { desc = "Next comment" })

    vim.keymap.set("n", "[C", function()
        require("neo_reviewer").prev_comment()
    end, { desc = "Previous comment" })

    vim.keymap.set("n", "<CR>", function()
        require("neo_reviewer").toggle_prev_code()
    end, { desc = "Toggle old code preview" })

    vim.keymap.set("n", "<leader>cc", function()
        require("neo_reviewer").add_comment()
    end, { desc = "Add comment" })

    vim.keymap.set("v", "<leader>cc", ":AddComment<CR>",
        { desc = "Add comment on selection" })

    vim.keymap.set("n", "<leader>cv", function()
        require("neo_reviewer").show_comment()
    end, { desc = "View comment thread" })

    vim.keymap.set("n", "<leader>cf", function()
        require("neo_reviewer").show_file_picker()
    end, { desc = "Show files" })

    vim.keymap.set("n", "<leader>ca", function()
        require("neo_reviewer").approve()
    end, { desc = "Approve PR" })

    vim.keymap.set("n", "<leader>cr", function()
        require("neo_reviewer").request_changes()
    end, { desc = "Request changes" })

    vim.keymap.set("n", "<leader>cq", function()
        require("neo_reviewer").done()
    end, { desc = "Close review" })

    vim.keymap.set("n", "<leader>cs", function()
        require("neo_reviewer").sync()
    end, { desc = "Sync PR review" })

    vim.keymap.set("n", "<leader>ci", function()
        require("neo_reviewer").toggle_ai_feedback()
    end, { desc = "Show AI analysis" })
<

==============================================================================
vim:tw=78:ts=8:ft=help:norl:
